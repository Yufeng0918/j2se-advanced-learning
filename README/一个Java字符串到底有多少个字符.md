ä¸€ä¸ªJavaå­—ç¬¦ä¸²åˆ°åº•æœ‰å¤šå°‘ä¸ªå­—ç¬¦
==

## Javaå­—ç¬¦

ä¾ç…§Javaçš„æ–‡æ¡£ï¼Œ Javaä¸­çš„å­—ç¬¦å†…éƒ¨æ˜¯ä»¥UTF-16ç¼–ç æ–¹å¼è¡¨ç¤ºçš„ï¼Œæœ€å°å€¼æ˜¯ u0000 (0),æœ€å¤§å€¼æ˜¯uffff(65535)ï¼Œ ä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä»¥2ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œéš¾é“Javaæœ€å¤šåªèƒ½è¡¨ç¤º 65535ä¸ªå­—ç¬¦ã€‚

char: The char data type is a single 16-bit Unicode character. It has a minimum value of 'u0000' (or 0) and a maximum value of 'uffff' (or 65,535 inclusive). from The Javaâ„¢ Tutorials



## ç¤ºä¾‹
```java
public class StringTest {
    public static void main(String[] args) {
        // ä¸­æ–‡å¸¸è§å­—
        String s = "ä½ å¥½";
        System.out.println("1. string length =" + s.length());
        System.out.println("1. string bytes length =" + s.getBytes().length);
        System.out.println("1. string char length =" + s.toCharArray().length);
        System.out.println();

        // emojis
        s = "ğŸ‘¦ğŸ‘©";
        System.out.println("2. string length =" + s.length());
        System.out.println("2. string bytes length =" + s.getBytes().length);
        System.out.println("2. string char length =" + s.toCharArray().length);
        System.out.println();

        // ä¸­æ–‡ç”Ÿåƒ»å­—
        s = "ğ¡ƒå¦¹";
        System.out.println("3. string length =" + s.length());
        System.out.println("3. string bytes length =" + s.getBytes().length);
        System.out.println("3. string char length =" + s.toCharArray().length);
        System.out.println();

    }
}
```

è¾“å‡ºç»“æœ
```text
1. string length =2
1. string bytes length =6
1. string char length =2

2. string length =4
2. string bytes length =8
2. string char length =4

3. string length =3
3. string bytes length =7
3. string char length =3
```

## åˆ†æ

String.getByteså¦‚æœä¸æŒ‡å®šç¼–ç æ ¼å¼ï¼ŒJavaä¼šä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç¼–ç æ ¼å¼å¾—åˆ°å­—èŠ‚æ•°ç»„ï¼Œåœ¨æˆ‘çš„MacOSä¸­ï¼Œé»˜è®¤ä½¿ç”¨UTF-8ä½œä¸ºå­—ç¬¦ç¼–ç (localeå‘½ä»¤å¯ä»¥æŸ¥çœ‹æ“ä½œç³»ç»Ÿçš„ç¼–ç )ï¼Œæ‰€ä»¥åœ¨æˆ‘çš„æœºå™¨è¿è¡Œï¼ŒString.getBytesä¼šè¿”å›UTF-8ç¼–ç çš„å­—èŠ‚æ•°ç»„ã€‚

**String.lengthè¿”å›Unicode code unitsçš„é•¿åº¦**ã€‚String.toCharArrayè¿”å›å­—ç¬¦æ•°ç»„ã€‚

æˆ‘ä»¬è®¾ç½®çš„å­—ç¬¦ä¸²éƒ½æ˜¯ä¸¤ä¸ªunicodeå­—ç¬¦ï¼Œè¾“å‡ºç»“æœï¼š

**æ™®é€šçš„ä¸­æ–‡å­—**ï¼šå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯2ï¼Œæ¯ä¸ªä¸­æ–‡å­—æŒ‰UTF-8ç¼–ç æ˜¯ä¸‰ä¸ªå­—èŠ‚ï¼Œå­—ç¬¦æ•°ç»„çš„é•¿åº¦çœ‹èµ·æ¥ä¹Ÿæ²¡é—®é¢˜

**emojiså­—ç¬¦**ï¼šæˆ‘ä»¬è®¾ç½®äº†ä¸¤ä¸ªemojiså­—ç¬¦ï¼Œç”·å¥³å¤´åƒã€‚ç»“æœå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯4, UTF-8ç¼–ç 8ä¸ªå­—èŠ‚ï¼Œå­—ç¬¦æ•°ç»„çš„é•¿åº¦æ˜¯4

**ç”Ÿåƒ»çš„ä¸­æ–‡å­—**ï¼šæˆ‘ä»¬è®¾ç½®äº†ä¸¤ä¸ªä¸­æ–‡å­—ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ç”Ÿåƒ»çš„ä¸­æ–‡å­—ã€‚ç»“æœå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯3ï¼ŒUTF-8ç¼–ç 7ä¸ªå­—èŠ‚ï¼Œå­—ç¬¦æ•°ç»„çš„é•¿åº¦æ˜¯3

**çœ‹èµ·æ¥å­—ç¬¦ä¸²çš„å­—ç¬¦æ•°å’Œæˆ‘ä»¬é¢„æœŸçš„æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬çš„å­—ç¬¦ä¸²åªæœ‰ä¸¤ä¸ªunicodeå­—ç¬¦, å¯æ˜¯è¾“å‡ºç»“æœæœ‰æ—¶å€™æ˜¯2ï¼Œæœ‰æ—¶å€™æ˜¯3ï¼Œ æœ‰æ—¶å€™æ˜¯4ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ** 



## è¿™è¿˜å¾—ä»Javaçš„å†å²è¯´èµ·

Javaæœ€åˆè®¾è®¡çš„Charactorç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºunicodeå­—ç¬¦ï¼Œè¿™æ²¡æœ‰é—®é¢˜ï¼Œ å› ä¸ºæœ€åˆunicodeä¸­çš„å­—ç¬¦è¿˜æ¯”è¾ƒå°‘ï¼Œ 

Java 1.1ä¹‹å‰é‡‡ç”¨Unicode version 1.1.5, 
JDK 1.1ä¸­æ”¯æŒUnicode 2.0,
JDK 1.1.7æ”¯æŒUnicode 2.1, 
Java SE 1.4 æ”¯æŒ Unicode 3.0, 
Java SE 5.0å¼€å§‹æ”¯æŒUnicode 4.0ã€‚

ç›´åˆ°Unicode 3.0, Javaç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºunicodeå­—ç¬¦è¿˜æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºUnicode 3.0æœ€å¤š49,259ä¸ªå­—ç¬¦ï¼Œ ä¸¤ä¸ªå­—èŠ‚å¯ä»¥è¡¨ç¤º 65,535 ä¸ªå­—ç¬¦ï¼Œè¿˜è¶³å¤Ÿå®¹çš„ä¸‹æ‰€æœ‰çš„uicode3.0å­—ç¬¦ã€‚

ä½†æ˜¯Unicode 4.0(äº‹å®ä¸Šè‡ªUnicode 3.1), å­—ç¬¦é›†è¿›è¡Œå¾ˆå¤§çš„æ‰©å……ï¼Œå·²ç»è¾¾åˆ°äº†96,447ä¸ªå­—ç¬¦ï¼ŒUnicode 11.0å·²ç»åŒ…å« 137,374ä¸ªå­—ç¬¦ã€‚åœ¨Unicodeä¸­ï¼Œä¸ºæ¯ä¸€ä¸ªå­—ç¬¦å¯¹åº”ä¸€ä¸ªç¼–ç ç‚¹(ä¸€ä¸ªæ•´æ•°)ï¼Œç”¨ U+ç´§è·Ÿç€åå…­è¿›åˆ¶æ•°è¡¨ç¤ºã€‚æ‰€æœ‰å­—ç¬¦æŒ‰ç…§ä½¿ç”¨ä¸Šçš„é¢‘ç¹åº¦åˆ’åˆ†ä¸º 17 ä¸ªå¹³é¢ï¼ˆç¼–å·ä¸º 0-16ï¼‰ï¼Œå³åŸºæœ¬çš„å¤šè¯­è¨€å¹³é¢å’Œå¢è¡¥å¹³é¢ã€‚åŸºæœ¬çš„å¤šè¯­è¨€å¹³é¢ï¼ˆè‹±æ–‡ä¸º Basic Multilingual Planeï¼Œç®€ç§° BMPï¼‰åˆç§°å¹³é¢ 0ï¼Œæ”¶é›†äº†ä½¿ç”¨æœ€å¹¿æ³›çš„å­—ç¬¦ã€‚

**Javaçš„Charactorçš„ä¸¤ä¸ªå­—èŠ‚çš„è®¾è®¡ï¼Œå·²ç»ä¸è¶³ä»¥å®¹çº³æ‰€æœ‰çš„Unicode 4çš„å­—ç¬¦ï¼Œ æ‰€ä»¥å¯èƒ½éœ€è¦4ä¸ªå­—èŠ‚æ‰èƒ½è¡¨ç¤ºæ‰©å±•å­—ç¬¦**ï¼Œæ‰€ä»¥ç°åœ¨çš„**Charactorä»£è¡¨çš„å·²ç»ä¸å†æ˜¯ä¸€ä¸ªå­—ç¬¦è€Œæ˜¯ä»£ç ç‚¹(code point)**ï¼Œå®ƒä¸€ä¸ªä»£ç å•å…ƒ(code unit)ã€‚

**Code Point:ä»£ç ç‚¹**

+ ä¸€ä¸ªå­—ç¬¦çš„æ•°å­—è¡¨ç¤ºã€‚ä¸€ä¸ªå­—ç¬¦é›†ä¸€èˆ¬å¯ä»¥ç”¨ä¸€å¼ æˆ–å¤šå¼ ç”±å¤šä¸ªè¡Œå’Œå¤šä¸ªåˆ—æ‰€æ„æˆçš„äºŒç»´è¡¨æ¥è¡¨ç¤ºã€‚
+ äºŒç»´è¡¨ä¸­è¡Œä¸åˆ—äº¤å‰çš„ç‚¹ç§°ä¹‹ä¸ºä»£ç ç‚¹ï¼Œæ¯ä¸ªç ç‚¹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·æ•°å­—ï¼Œç§°ä¹‹ä¸ºç ç‚¹å€¼æˆ–ç ç‚¹ç¼–å·ï¼Œ
+ é™¤å¼€æŸäº›ç‰¹æ®ŠåŒºåŸŸ(æ¯”å¦‚ä»£ç†åŒºã€ä¸“ç”¨åŒº)çš„éå­—ç¬¦ä»£ç ç‚¹å’Œä¿ç•™ä»£ç ç‚¹ï¼Œ
+ æ¯ä¸ªä»£ç ç‚¹å”¯ä¸€å¯¹åº”äºä¸€ä¸ªå­—ç¬¦ã€‚ä»U+0000 åˆ° U+10FFFFã€‚

**Code Unitï¼šä»£ç å•å…ƒ**

+ æ˜¯æŒ‡ä¸€ä¸ªå·²ç¼–ç çš„æ–‡æœ¬ä¸­å…·æœ‰æœ€çŸ­çš„æ¯”ç‰¹ç»„åˆçš„å•å…ƒã€‚å¯¹äº UTF-8 æ¥è¯´ï¼Œä»£ç å•å…ƒæ˜¯ 8 æ¯”ç‰¹é•¿ï¼›
+ UTF-8 çš„æ˜¯ä»¥ä¸€ä¸ªå­—èŠ‚ä¸ºæœ€å°å•ä½çš„
+ UTF-16 æ˜¯ä»¥ä¸¤ä¸ªå­—èŠ‚ä¸ºæœ€å°å•ä½çš„ã€‚



Javaçš„å­—ç¬¦åœ¨å†…éƒ¨ä»¥UTF-16ç¼–ç æ–¹å¼æ¥è¡¨ç¤ºï¼Œ**String.lengthè¿”å›çš„æ˜¯Code Unitçš„é•¿åº¦ï¼Œè€Œä¸å†æ˜¯Unicodeä¸­å­—ç¬¦çš„é•¿åº¦**ã€‚å¯¹äºä¼ ç»Ÿçš„BMPå¹³é¢çš„ä»£ç ç‚¹ï¼ŒString.lengthå’Œæˆ‘ä»¬ä¼ ç»Ÿç†è§£çš„å­—ç¬¦çš„æ•°é‡æ˜¯ä¸€è‡´çš„ï¼Œå¯¹äºæ‰©å±•çš„å­—ç¬¦ï¼ŒString.lengthå¯èƒ½æ˜¯æˆ‘ä»¬ç†è§£çš„å­—ç¬¦é•¿åº¦çš„ä¸¤å€ã€‚



æœ‰å¯èƒ½ä½ ä¼šé—®ï¼Œ å¯¹äºä¸€ä¸ªUTF-16ç¼–ç çš„æ‰©å±•å­—ç¬¦ï¼Œå®ƒä»¥4ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œé‚£ä¹ˆå‰ä¸¤ä¸ªå­—èŠ‚ä¼šä¸ä¼šå’ŒBMPå¹³é¢å†²çªï¼Œå¯¼è‡´ç¨‹åºä¸çŸ¥é“å®ƒæ˜¯æ‰©å±•å­—ç¬¦è¿˜æ˜¯BMPå¹³é¢çš„å­—ç¬¦ï¼Ÿå…¶å®æ˜¯ä¸ä¼šçš„ï¼Œ å¹¸è¿çš„æ˜¯ï¼Œ åœ¨BMPå¹³é¢ä¸­ï¼Œ U+D800åˆ°U+DFFFä¹‹é—´çš„ç ä½æ˜¯æ°¸ä¹…ä¿ç•™ä¸æ˜ å°„åˆ°Unicodeå­—ç¬¦ï¼ŒUTF-16å°±åˆ©ç”¨ä¿ç•™ä¸‹æ¥çš„0xD800-0xDFFFåŒºå—çš„ç ä½æ¥å¯¹è¾…åŠ©å¹³é¢çš„å­—ç¬¦çš„ç ä½è¿›è¡Œç¼–ç ã€‚

UTF-16ç¼–ç ä¸­ï¼Œè¾…åŠ©å¹³é¢ä¸­çš„ç ä½ä»U+10000åˆ°U+10FFFFï¼Œå…±è®¡FFFFFä¸ª,éœ€è¦20ä½æ¥è¡¨ç¤ºã€‚ç¬¬ä¸€ä¸ªæ•´æ•°ï¼ˆä¸¤ä¸ªå­—èŠ‚ï¼Œç§°ä¸ºå‰å¯¼ä»£ç†ï¼‰ã€‚è¦å®¹çº³ä¸Šè¿°20ä½çš„å‰10ä½ï¼Œç¬¬äºŒä¸ªæ•´æ•°ï¼ˆç§°ä¸ºåå°¾ä»£ç†ï¼‰å®¹çº³ä¸Šè¿°20ä½çš„å10ä½ã€‚

å‰å¯¼ä»£ç†çš„å€¼çš„èŒƒå›´æ˜¯0xD800åˆ°0xDBFF,åå°¾ä»£ç†çš„0xDC00~0xDFFFã€‚å¯ä»¥çœ‹åˆ°å‰å¯¼ä»£ç†å’Œåå°¾ä»£ç†çš„èŒƒå›´éƒ½è½åœ¨äº†BMPå¹³é¢ä¸­ä¸ç”¨æ¥æ˜ å°„çš„ç ä½ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿå†²çªï¼Œè€Œä¸”å‰å¯¼ä»£ç†å’Œåå°¾ä»£ç†ä¹Ÿæ²¡æœ‰é‡åˆã€‚

è¿™æ ·æˆ‘ä»¬å¾—åˆ°ä¸¤ä¸ªå­—èŠ‚çš„ï¼Œå°±å¯ä»¥ç›´æ¥åˆ¤æ–­å®ƒæ˜¯å¦æ˜¯BMPå¹³é¢çš„å­—ç¬¦ï¼Œè¿˜æ˜¯æ‰©å±•å­—ç¬¦ä¸­çš„å‰å¯¼ä»£ç†è¿˜æ˜¯åå°¾ä»£ç ã€‚

å›½å¤–çš„æœ‰äº›ç”¨æˆ·ç”¨emojiså­—ç¬¦åšè‡ªå·±çš„æ˜µç§°ï¼Œå¯¼è‡´æœ‰äº›ç³»ç»Ÿä¸èƒ½æ­£ç¡®çš„æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™æ˜¯å› ä¸ºè¿™äº›ç³»ç»Ÿç²—æš´çš„ä½¿ç”¨Charactoræ¥è¡¨ç¤ºï¼Œåœ¨æ˜¾ç¤ºçš„æ—¶å€™æˆªæ–­çš„æ—¶å€™æœ‰æ—¶å€™å¯èƒ½ä¸æ˜¯åœ¨æ­£ç¡®çš„ä»£ç ç‚¹ä¸Šè¿›è¡Œæˆªæ–­ã€‚

æˆ‘ä»¬åœ¨è¿›è¡Œå­—ç¬¦ä¸²æˆªå–çš„æ—¶å€™,æ¯”å¦‚String.substringæœ‰å¯èƒ½ä¼šè¸©åˆ°ä¸€äº›å‘ï¼Œå°¤å…¶ç»å¸¸ä½¿ç”¨çš„emojiså­—ç¬¦ã€‚è‡ª Java 1.5 java.lang.Stringå°±æä¾›äº†Code Pointæ–¹æ³•ï¼Œ ç”¨æ¥è·å–å®Œæ•´çš„Unicodeå­—ç¬¦å’ŒUnicodeå­—ç¬¦æ•°é‡

```JAVA
public int codePointAt(int index)

public int codePointBefore(int index)

public int codePointCount(int beginIndex, int endIndex)
```

æ³¨æ„è¿™äº›æ–¹æ³•ä¸­çš„indexä½¿ç”¨çš„æ˜¯code unitå€¼ã€‚




## å‚è€ƒæ–‡æ¡£<sup>[1]</sup>
https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html

https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Character.html

http://www.oracle.com/us/technologies/java/supplementary-142654.html

https://stackoverflow.com/questions/2533097/java-unicode-encoding

https://docs.oracle.com/javase/specs/jls/se7/html/jls-3.html

https://zh.wikipedia.org/wiki/Unicode

https://codeahoy.com/2016/05/08/the-char-type-in-java-is-broken/

https://zh.wikipedia.org/wiki/UTF-16

https://wiki.sei.cmu.edu/confluence/display/java/STR50-J.+Use+the+appropriate+method+for+counting+characters+in+a+string

http://stn.audible.com/abcs-of-unicode/#common-unicode-mistakes-in-java-apps


<!--
å®šä¹‰URLå˜é‡
-->

[1]:http://www.sohu.com/a/340992079_733133 "ä¸€ä¸ªJavaå­—ç¬¦ä¸²åˆ°åº•æœ‰å¤šå°‘ä¸ªå­—ç¬¦"